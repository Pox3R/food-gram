# food-gram
## Telegram-бот, который упрощает процесс заказа еды для группы людей.

### Как зпустить

Бот может быть запущен в виде модуля Python 3.7
```bash
pip install -r requirements.txt
python -m foodgram
```
Конфигурация бота выполняется с помощью перменных среды. Значения параметров также могут быть заданы с помощью 
конфигурационного файла `config.env`. Перечень параметров приведен в `example_config.env`. 

### Как пользоваться
1. При первом заказе необходимо добавить бота в групповой чат, где вы планируете заказ еды. 
	- **Каждый участник чата должен иметь личный диалог с ботом.**
2. Для начала заказа отправьте боту в групповом чате команду `/start`. 
	- Человек, начавший заказ, отмечается как ответственный за заказ и получает уведомление в личные сообщения.
	- **Один человек не может быть ответственным за несколько заказов одновременно.**
	- **Один человек не может быть ответственным за один заказ и являться участником другого заказа одновременно.**
3. Затем, каждый из участников чата может предложить место (одно или несколько) для заказа еды.
	- Предложить место можно с помощью команды `/addplace <место>`.
	- Или воспользовавшись кнопкой `"Предложить место из списка"`, которая предложит выбрать из списка мест, предложенных в предыдущих заказах.
4. Выбор места заказа осуществляется путем голосования за одно из предложенных на предыдущем шаге мест.
	- Команды, управляющие голосованием доступны только ответственному за заказ.
	- Начать голосование можно командой `/startpoll`.
	- Завершить голосование можно командой `/finishpoll` - бот выберет для заказа место, набравшее наибольшее количесво голосов.
	- Если в голосовании есть несколько мест, набравших одинаковое количество голосов, будет предложено повторное голосование, содержащее только эти места.
5. После завершения голосования бот объявляет место для заказа и предлагает присоединиться к заказу.
	- Каждый из участников чата может присоединиться к заказу, нажав кнопку `"Принять участие в формировании заказа"`.
	- Участник, присоединившийся к заказу, получает в личные сообщения уведомление от бота и получает статус "участник заказа".
		- **Если у участника отсутствует личный диалог с ботом, он не сможет получить уведомление, но будет считаться участником заказа.**
		- **Человек не может быть одновременно участником нескольких заказов.**
6. Участники заказа делают свои заказы в личном диалоге с ботом.
	- Заказать блюдо можно командой `/add <блюдо>` или кнопкой `"Добавить блюдо"`, которая предложит на выбор блюда из предыдущих заказов участника.
		- Если участник делает первый заказ в боте или не заказывал еду через бот более месяца, то кнопка `"добавить блюдо"` вернет пустой список.
	- Убрать блюдо из заказа можно командой `/delete <блюдо>` или с помощью кнопки `"Удалить блюдо"`, которая предложит выбрать блюдо из заказа для удаления.
	- Посмотреть свой заказ можно командой `/list`.
	- Изменить позицию заказа можно командой `/change <номер_блюда> <новое_блюдо>`, где номер_блюда - порядковый номер блюда в списке, получаемом командой `/list`.
	- Участник заказа может отказаться от участия в заказе с помощью команды `/cancel`. В таком случае он перестает быть участником заказа, а его заказ удаляется.
	- Участник может сообщить ответственному за заказ о том, что завершил заказ, командой `/finish`.
		- После завершения локального заказа командой `/finish` участник все еще может редактировать свой заказ.
7. Ответственный за заказ имеет возможность посмотреть статус каждого из участников заказа. Для этого в личном диалоге с ботом необходимо выбрать команду `/status`.
8. Ответственный за заказ может завершить общий заказ в групповом чате с помощью команды `/finishorder`.
	- **Завершение общего заказа не зависит от статуса заказов участников.**
	- После завершения заказа ответственному за заказ в личные сообщения приходит содержание общего заказа.
9. До завершения заказа командой `/finishorder`, ответственный за заказ может в любой момент отменить заказ командой `/cancelorder` в групповом чате.
10. После того, как заказ доставлен, ответственный за заказ может использовать команду `/notify` для уведомления участников о доставке заказа.
	- Все участники заказа с настроенными никнеймами будут упомянуты (@никнейм) в сообщении о доставке.
	- Участники заказа, у которых не настроен никнейм, получат уведомление о доставке в личные сообщения.
11. После того, как заказ доставлен, ответственный за заказ может загрузить в групповой чат фотографию с qr-кодом чека для распознавания.
	- **При загрузке чека необходимо указать команду `/bill`.**
	- Загрузка чека не является обязательным пунктом заказа, но может повлиять на отображение суммы заказа в разделе статистики.
12. После загрузки чека выполняется его распознавание и сопоставление позиций чека с заказами участников.
	- Для каждого участника дополнительно подсчитывается суммарная стоимость распознанных позиций.
	- Не все позиции чека могут быть сопоставлены с заказами участников, нераспознанные позиции отображаются в разделе "не удалось распознать".
	- Каждый участник заказа может распознать позицию своего заказа из раздела "не удалось распознать" с помощью команды `/take <блюдо>` или кнопки `"Опознать блюдо"`.
	- Каждый участник заказа может перенести неверно распознанную позицию из своего заказа в раздел "не удалось распознать" с помощью команды `/drop <блюдо>` или кнопки `"Неверное распознавание"`.
	- Распознавание всех позиций чека не является обязательным. Заказ может быть завершен при любом состоянии чека.
13. После завершения процесса заказа ответственный за заказ закрывает заказ в групповом чате командой `/closeorder`.
	- **Закрытие заказа является обязательным. Невозможно начать новый заказ в данном чате до закрытия старого заказа.**
14. Участникам чата доступна статистика заказов с помощью команды `/stats`.
	- Команда `/stats` в групповом чате возвращает ссылку на веб-страницу со статистикой заказов для данного чата.
	- Команда `/stats` в личном диалоге с ботом возвращает ссылку на веб-страницу со статистикой заказов для пользователя.
15. Все команды бота с кратким описанием функциональности доступны по команде `/help`.

